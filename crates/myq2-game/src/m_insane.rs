// m_insane.rs â€” Insane (crucified/crawling) monster
// Converted from: myq2-original/game/m_insane.c
// Frame definitions from: myq2-original/game/m_insane.h

use crate::g_local::*;
use crate::game::*;
use crate::game_import::skill_value;
use myq2_common::common::{frand as random, rand_i32};

// ============================================================
// Frame definitions (from m_insane.h)
// This file generated by ModelGen - Do NOT Modify
// ============================================================

pub const FRAME_STAND1: i32 = 0;
pub const FRAME_STAND2: i32 = 1;
pub const FRAME_STAND3: i32 = 2;
pub const FRAME_STAND4: i32 = 3;
pub const FRAME_STAND5: i32 = 4;
pub const FRAME_STAND6: i32 = 5;
pub const FRAME_STAND7: i32 = 6;
pub const FRAME_STAND8: i32 = 7;
pub const FRAME_STAND9: i32 = 8;
pub const FRAME_STAND10: i32 = 9;
pub const FRAME_STAND11: i32 = 10;
pub const FRAME_STAND12: i32 = 11;
pub const FRAME_STAND13: i32 = 12;
pub const FRAME_STAND14: i32 = 13;
pub const FRAME_STAND15: i32 = 14;
pub const FRAME_STAND16: i32 = 15;
pub const FRAME_STAND17: i32 = 16;
pub const FRAME_STAND18: i32 = 17;
pub const FRAME_STAND19: i32 = 18;
pub const FRAME_STAND20: i32 = 19;
pub const FRAME_STAND21: i32 = 20;
pub const FRAME_STAND22: i32 = 21;
pub const FRAME_STAND23: i32 = 22;
pub const FRAME_STAND24: i32 = 23;
pub const FRAME_STAND25: i32 = 24;
pub const FRAME_STAND26: i32 = 25;
pub const FRAME_STAND27: i32 = 26;
pub const FRAME_STAND28: i32 = 27;
pub const FRAME_STAND29: i32 = 28;
pub const FRAME_STAND30: i32 = 29;
pub const FRAME_STAND31: i32 = 30;
pub const FRAME_STAND32: i32 = 31;
pub const FRAME_STAND33: i32 = 32;
pub const FRAME_STAND34: i32 = 33;
pub const FRAME_STAND35: i32 = 34;
pub const FRAME_STAND36: i32 = 35;
pub const FRAME_STAND37: i32 = 36;
pub const FRAME_STAND38: i32 = 37;
pub const FRAME_STAND39: i32 = 38;
pub const FRAME_STAND40: i32 = 39;
pub const FRAME_STAND41: i32 = 40;
pub const FRAME_STAND42: i32 = 41;
pub const FRAME_STAND43: i32 = 42;
pub const FRAME_STAND44: i32 = 43;
pub const FRAME_STAND45: i32 = 44;
pub const FRAME_STAND46: i32 = 45;
pub const FRAME_STAND47: i32 = 46;
pub const FRAME_STAND48: i32 = 47;
pub const FRAME_STAND49: i32 = 48;
pub const FRAME_STAND50: i32 = 49;
pub const FRAME_STAND51: i32 = 50;
pub const FRAME_STAND52: i32 = 51;
pub const FRAME_STAND53: i32 = 52;
pub const FRAME_STAND54: i32 = 53;
pub const FRAME_STAND55: i32 = 54;
pub const FRAME_STAND56: i32 = 55;
pub const FRAME_STAND57: i32 = 56;
pub const FRAME_STAND58: i32 = 57;
pub const FRAME_STAND59: i32 = 58;
pub const FRAME_STAND60: i32 = 59;
pub const FRAME_STAND61: i32 = 60;
pub const FRAME_STAND62: i32 = 61;
pub const FRAME_STAND63: i32 = 62;
pub const FRAME_STAND64: i32 = 63;
pub const FRAME_STAND65: i32 = 64;
pub const FRAME_STAND66: i32 = 65;
pub const FRAME_STAND67: i32 = 66;
pub const FRAME_STAND68: i32 = 67;
pub const FRAME_STAND69: i32 = 68;
pub const FRAME_STAND70: i32 = 69;
pub const FRAME_STAND71: i32 = 70;
pub const FRAME_STAND72: i32 = 71;
pub const FRAME_STAND73: i32 = 72;
pub const FRAME_STAND74: i32 = 73;
pub const FRAME_STAND75: i32 = 74;
pub const FRAME_STAND76: i32 = 75;
pub const FRAME_STAND77: i32 = 76;
pub const FRAME_STAND78: i32 = 77;
pub const FRAME_STAND79: i32 = 78;
pub const FRAME_STAND80: i32 = 79;
pub const FRAME_STAND81: i32 = 80;
pub const FRAME_STAND82: i32 = 81;
pub const FRAME_STAND83: i32 = 82;
pub const FRAME_STAND84: i32 = 83;
pub const FRAME_STAND85: i32 = 84;
pub const FRAME_STAND86: i32 = 85;
pub const FRAME_STAND87: i32 = 86;
pub const FRAME_STAND88: i32 = 87;
pub const FRAME_STAND89: i32 = 88;
pub const FRAME_STAND90: i32 = 89;
pub const FRAME_STAND91: i32 = 90;
pub const FRAME_STAND92: i32 = 91;
pub const FRAME_STAND93: i32 = 92;
pub const FRAME_STAND94: i32 = 93;
pub const FRAME_STAND95: i32 = 94;
pub const FRAME_STAND96: i32 = 95;
pub const FRAME_STAND97: i32 = 96;
pub const FRAME_STAND98: i32 = 97;
pub const FRAME_STAND99: i32 = 98;
pub const FRAME_STAND100: i32 = 99;
pub const FRAME_STAND101: i32 = 100;
pub const FRAME_STAND102: i32 = 101;
pub const FRAME_STAND103: i32 = 102;
pub const FRAME_STAND104: i32 = 103;
pub const FRAME_STAND105: i32 = 104;
pub const FRAME_STAND106: i32 = 105;
pub const FRAME_STAND107: i32 = 106;
pub const FRAME_STAND108: i32 = 107;
pub const FRAME_STAND109: i32 = 108;
pub const FRAME_STAND110: i32 = 109;
pub const FRAME_STAND111: i32 = 110;
pub const FRAME_STAND112: i32 = 111;
pub const FRAME_STAND113: i32 = 112;
pub const FRAME_STAND114: i32 = 113;
pub const FRAME_STAND115: i32 = 114;
pub const FRAME_STAND116: i32 = 115;
pub const FRAME_STAND117: i32 = 116;
pub const FRAME_STAND118: i32 = 117;
pub const FRAME_STAND119: i32 = 118;
pub const FRAME_STAND120: i32 = 119;
pub const FRAME_STAND121: i32 = 120;
pub const FRAME_STAND122: i32 = 121;
pub const FRAME_STAND123: i32 = 122;
pub const FRAME_STAND124: i32 = 123;
pub const FRAME_STAND125: i32 = 124;
pub const FRAME_STAND126: i32 = 125;
pub const FRAME_STAND127: i32 = 126;
pub const FRAME_STAND128: i32 = 127;
pub const FRAME_STAND129: i32 = 128;
pub const FRAME_STAND130: i32 = 129;
pub const FRAME_STAND131: i32 = 130;
pub const FRAME_STAND132: i32 = 131;
pub const FRAME_STAND133: i32 = 132;
pub const FRAME_STAND134: i32 = 133;
pub const FRAME_STAND135: i32 = 134;
pub const FRAME_STAND136: i32 = 135;
pub const FRAME_STAND137: i32 = 136;
pub const FRAME_STAND138: i32 = 137;
pub const FRAME_STAND139: i32 = 138;
pub const FRAME_STAND140: i32 = 139;
pub const FRAME_STAND141: i32 = 140;
pub const FRAME_STAND142: i32 = 141;
pub const FRAME_STAND143: i32 = 142;
pub const FRAME_STAND144: i32 = 143;
pub const FRAME_STAND145: i32 = 144;
pub const FRAME_STAND146: i32 = 145;
pub const FRAME_STAND147: i32 = 146;
pub const FRAME_STAND148: i32 = 147;
pub const FRAME_STAND149: i32 = 148;
pub const FRAME_STAND150: i32 = 149;
pub const FRAME_STAND151: i32 = 150;
pub const FRAME_STAND152: i32 = 151;
pub const FRAME_STAND153: i32 = 152;
pub const FRAME_STAND154: i32 = 153;
pub const FRAME_STAND155: i32 = 154;
pub const FRAME_STAND156: i32 = 155;
pub const FRAME_STAND157: i32 = 156;
pub const FRAME_STAND158: i32 = 157;
pub const FRAME_STAND159: i32 = 158;
pub const FRAME_STAND160: i32 = 159;
pub const FRAME_WALK27: i32 = 160;
pub const FRAME_WALK28: i32 = 161;
pub const FRAME_WALK29: i32 = 162;
pub const FRAME_WALK30: i32 = 163;
pub const FRAME_WALK31: i32 = 164;
pub const FRAME_WALK32: i32 = 165;
pub const FRAME_WALK33: i32 = 166;
pub const FRAME_WALK34: i32 = 167;
pub const FRAME_WALK35: i32 = 168;
pub const FRAME_WALK36: i32 = 169;
pub const FRAME_WALK37: i32 = 170;
pub const FRAME_WALK38: i32 = 171;
pub const FRAME_WALK39: i32 = 172;
pub const FRAME_WALK1: i32 = 173;
pub const FRAME_WALK2: i32 = 174;
pub const FRAME_WALK3: i32 = 175;
pub const FRAME_WALK4: i32 = 176;
pub const FRAME_WALK5: i32 = 177;
pub const FRAME_WALK6: i32 = 178;
pub const FRAME_WALK7: i32 = 179;
pub const FRAME_WALK8: i32 = 180;
pub const FRAME_WALK9: i32 = 181;
pub const FRAME_WALK10: i32 = 182;
pub const FRAME_WALK11: i32 = 183;
pub const FRAME_WALK12: i32 = 184;
pub const FRAME_WALK13: i32 = 185;
pub const FRAME_WALK14: i32 = 186;
pub const FRAME_WALK15: i32 = 187;
pub const FRAME_WALK16: i32 = 188;
pub const FRAME_WALK17: i32 = 189;
pub const FRAME_WALK18: i32 = 190;
pub const FRAME_WALK19: i32 = 191;
pub const FRAME_WALK20: i32 = 192;
pub const FRAME_WALK21: i32 = 193;
pub const FRAME_WALK22: i32 = 194;
pub const FRAME_WALK23: i32 = 195;
pub const FRAME_WALK24: i32 = 196;
pub const FRAME_WALK25: i32 = 197;
pub const FRAME_WALK26: i32 = 198;
pub const FRAME_ST_PAIN2: i32 = 199;
pub const FRAME_ST_PAIN3: i32 = 200;
pub const FRAME_ST_PAIN4: i32 = 201;
pub const FRAME_ST_PAIN5: i32 = 202;
pub const FRAME_ST_PAIN6: i32 = 203;
pub const FRAME_ST_PAIN7: i32 = 204;
pub const FRAME_ST_PAIN8: i32 = 205;
pub const FRAME_ST_PAIN9: i32 = 206;
pub const FRAME_ST_PAIN10: i32 = 207;
pub const FRAME_ST_PAIN11: i32 = 208;
pub const FRAME_ST_PAIN12: i32 = 209;
pub const FRAME_ST_DEATH2: i32 = 210;
pub const FRAME_ST_DEATH3: i32 = 211;
pub const FRAME_ST_DEATH4: i32 = 212;
pub const FRAME_ST_DEATH5: i32 = 213;
pub const FRAME_ST_DEATH6: i32 = 214;
pub const FRAME_ST_DEATH7: i32 = 215;
pub const FRAME_ST_DEATH8: i32 = 216;
pub const FRAME_ST_DEATH9: i32 = 217;
pub const FRAME_ST_DEATH10: i32 = 218;
pub const FRAME_ST_DEATH11: i32 = 219;
pub const FRAME_ST_DEATH12: i32 = 220;
pub const FRAME_ST_DEATH13: i32 = 221;
pub const FRAME_ST_DEATH14: i32 = 222;
pub const FRAME_ST_DEATH15: i32 = 223;
pub const FRAME_ST_DEATH16: i32 = 224;
pub const FRAME_ST_DEATH17: i32 = 225;
pub const FRAME_ST_DEATH18: i32 = 226;
pub const FRAME_CRAWL1: i32 = 227;
pub const FRAME_CRAWL2: i32 = 228;
pub const FRAME_CRAWL3: i32 = 229;
pub const FRAME_CRAWL4: i32 = 230;
pub const FRAME_CRAWL5: i32 = 231;
pub const FRAME_CRAWL6: i32 = 232;
pub const FRAME_CRAWL7: i32 = 233;
pub const FRAME_CRAWL8: i32 = 234;
pub const FRAME_CRAWL9: i32 = 235;
pub const FRAME_CR_PAIN2: i32 = 236;
pub const FRAME_CR_PAIN3: i32 = 237;
pub const FRAME_CR_PAIN4: i32 = 238;
pub const FRAME_CR_PAIN5: i32 = 239;
pub const FRAME_CR_PAIN6: i32 = 240;
pub const FRAME_CR_PAIN7: i32 = 241;
pub const FRAME_CR_PAIN8: i32 = 242;
pub const FRAME_CR_PAIN9: i32 = 243;
pub const FRAME_CR_PAIN10: i32 = 244;
pub const FRAME_CR_DEATH10: i32 = 245;
pub const FRAME_CR_DEATH11: i32 = 246;
pub const FRAME_CR_DEATH12: i32 = 247;
pub const FRAME_CR_DEATH13: i32 = 248;
pub const FRAME_CR_DEATH14: i32 = 249;
pub const FRAME_CR_DEATH15: i32 = 250;
pub const FRAME_CR_DEATH16: i32 = 251;
pub const FRAME_CROSS1: i32 = 252;
pub const FRAME_CROSS2: i32 = 253;
pub const FRAME_CROSS3: i32 = 254;
pub const FRAME_CROSS4: i32 = 255;
pub const FRAME_CROSS5: i32 = 256;
pub const FRAME_CROSS6: i32 = 257;
pub const FRAME_CROSS7: i32 = 258;
pub const FRAME_CROSS8: i32 = 259;
pub const FRAME_CROSS9: i32 = 260;
pub const FRAME_CROSS10: i32 = 261;
pub const FRAME_CROSS11: i32 = 262;
pub const FRAME_CROSS12: i32 = 263;
pub const FRAME_CROSS13: i32 = 264;
pub const FRAME_CROSS14: i32 = 265;
pub const FRAME_CROSS15: i32 = 266;
pub const FRAME_CROSS16: i32 = 267;
pub const FRAME_CROSS17: i32 = 268;
pub const FRAME_CROSS18: i32 = 269;
pub const FRAME_CROSS19: i32 = 270;
pub const FRAME_CROSS20: i32 = 271;
pub const FRAME_CROSS21: i32 = 272;
pub const FRAME_CROSS22: i32 = 273;
pub const FRAME_CROSS23: i32 = 274;
pub const FRAME_CROSS24: i32 = 275;
pub const FRAME_CROSS25: i32 = 276;
pub const FRAME_CROSS26: i32 = 277;
pub const FRAME_CROSS27: i32 = 278;
pub const FRAME_CROSS28: i32 = 279;
pub const FRAME_CROSS29: i32 = 280;
pub const FRAME_CROSS30: i32 = 281;

pub const MODEL_SCALE: f32 = 1.0;

// ============================================================
// Sound channel / attenuation constants (mirrors C defines)
// ============================================================

// CHAN_*, ATTN_* come from g_local::* re-export (myq2_common::q_shared)

use crate::ai_wrappers::{ai_stand, ai_walk, ai_move};
use crate::entity_adapters::{
    gi_sound, gi_soundindex, gi_modelindex, gi_linkentity,
    g_free_edict, walkmonster_start, flymonster_start,
    throw_gib, throw_head,
};

// ============================================================
// Sound indices (module-level state, replaces C statics)
// ============================================================

#[derive(Default)]
pub struct InsaneSounds {
    pub fist: i32,
    pub shake: i32,
    pub moan: i32,
    pub scream: [i32; 8],
}

static SOUNDS: std::sync::OnceLock<InsaneSounds> = std::sync::OnceLock::new();


fn va_pain_sound(l: i32, r: i32) -> String {
    format!("player/male/pain{}_{}.wav", l, r)
}

fn va_death_sound(n: i32) -> String {
    format!("player/male/death{}.wav", n)
}

// ============================================================
// Move index constants
// ============================================================

pub const MOVE_STAND_NORMAL: usize = 0;
pub const MOVE_STAND_INSANE: usize = 1;
pub const MOVE_UPTODOWN: usize = 2;
pub const MOVE_DOWNTOUP: usize = 3;
pub const MOVE_JUMPDOWN: usize = 4;
pub const MOVE_DOWN: usize = 5;
pub const MOVE_WALK_NORMAL: usize = 6;
pub const MOVE_RUN_NORMAL: usize = 7;
pub const MOVE_WALK_INSANE: usize = 8;
pub const MOVE_RUN_INSANE: usize = 9;
pub const MOVE_STAND_PAIN: usize = 10;
pub const MOVE_STAND_DEATH: usize = 11;
pub const MOVE_CRAWL: usize = 12;
pub const MOVE_RUNCRAWL: usize = 13;
pub const MOVE_CRAWL_PAIN: usize = 14;
pub const MOVE_CRAWL_DEATH: usize = 15;
pub const MOVE_CROSS: usize = 16;
pub const MOVE_STRUGGLE_CROSS: usize = 17;

// ============================================================
// Sound helper functions
// ============================================================

fn insane_fist(self_ent: &mut Edict, _ctx: &mut GameContext) {
    let snd = SOUNDS.get().map_or(0, |s| s.fist);
    gi_sound(self_ent, CHAN_VOICE, snd, 1.0, ATTN_IDLE, 0.0);
}

fn insane_shake(self_ent: &mut Edict, _ctx: &mut GameContext) {
    let snd = SOUNDS.get().map_or(0, |s| s.shake);
    gi_sound(self_ent, CHAN_VOICE, snd, 1.0, ATTN_IDLE, 0.0);
}

fn insane_moan(self_ent: &mut Edict, _ctx: &mut GameContext) {
    let snd = SOUNDS.get().map_or(0, |s| s.moan);
    gi_sound(self_ent, CHAN_VOICE, snd, 1.0, ATTN_IDLE, 0.0);
}

fn insane_scream(self_ent: &mut Edict, _ctx: &mut GameContext) {
    let idx = (rand_i32() % 8) as usize;
    let snd = SOUNDS.get().map_or(0, |s| s.scream[idx]);
    gi_sound(self_ent, CHAN_VOICE, snd, 1.0, ATTN_IDLE, 0.0);
}

// ============================================================
// Forward-declared behavior functions
// ============================================================

pub fn insane_stand(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if self_ent.spawnflags & 8 != 0 {
        // If crucified
        self_ent.monsterinfo.currentmove = Some(MOVE_CROSS);
        self_ent.monsterinfo.aiflags |= AI_STAND_GROUND;
    } else if (self_ent.spawnflags & 4 != 0) && (self_ent.spawnflags & 16 != 0) {
        // If Hold_Ground and Crawl are set
        self_ent.monsterinfo.currentmove = Some(MOVE_DOWN);
    } else if random() < 0.5 {
        self_ent.monsterinfo.currentmove = Some(MOVE_STAND_NORMAL);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_STAND_INSANE);
    }
}

pub fn insane_walk(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if self_ent.spawnflags & 16 != 0 {
        // Hold Ground?
        if self_ent.s.frame == FRAME_CR_PAIN10 {
            self_ent.monsterinfo.currentmove = Some(MOVE_DOWN);
            return;
        }
    }
    if self_ent.spawnflags & 4 != 0 {
        self_ent.monsterinfo.currentmove = Some(MOVE_CRAWL);
    } else if random() <= 0.5 {
        self_ent.monsterinfo.currentmove = Some(MOVE_WALK_NORMAL);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_WALK_INSANE);
    }
}

pub fn insane_run(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if self_ent.spawnflags & 16 != 0 {
        // Hold Ground?
        if self_ent.s.frame == FRAME_CR_PAIN10 {
            self_ent.monsterinfo.currentmove = Some(MOVE_DOWN);
            return;
        }
    }
    if self_ent.spawnflags & 4 != 0 {
        // Crawling?
        self_ent.monsterinfo.currentmove = Some(MOVE_RUNCRAWL);
    } else if random() <= 0.5 {
        // Else, mix it up
        self_ent.monsterinfo.currentmove = Some(MOVE_RUN_NORMAL);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_RUN_INSANE);
    }
}

fn insane_cross(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if random() < 0.8 {
        self_ent.monsterinfo.currentmove = Some(MOVE_CROSS);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_STRUGGLE_CROSS);
    }
}

fn insane_onground(self_ent: &mut Edict, _ctx: &mut GameContext) {
    self_ent.monsterinfo.currentmove = Some(MOVE_DOWN);
}

fn insane_checkdown(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if self_ent.spawnflags & 32 != 0 {
        // Always stand
        return;
    }
    if random() < 0.3 {
        if random() < 0.5 {
            self_ent.monsterinfo.currentmove = Some(MOVE_UPTODOWN);
        } else {
            self_ent.monsterinfo.currentmove = Some(MOVE_JUMPDOWN);
        }
    }
}

fn insane_checkup(self_ent: &mut Edict, _ctx: &mut GameContext) {
    // If Hold_Ground and Crawl are set
    if (self_ent.spawnflags & 4 != 0) && (self_ent.spawnflags & 16 != 0) {
        return;
    }
    if random() < 0.5 {
        self_ent.monsterinfo.currentmove = Some(MOVE_DOWNTOUP);
    }
}

fn insane_dead(self_ent: &mut Edict, _ctx: &mut GameContext) {
    if self_ent.spawnflags & 8 != 0 {
        self_ent.flags |= FL_FLY;
    } else {
        self_ent.mins = [-16.0, -16.0, -24.0];
        self_ent.maxs = [16.0, 16.0, -8.0];
        self_ent.movetype = MoveType::Toss;
    }
    self_ent.svflags |= SVF_DEADMONSTER;
    self_ent.nextthink = 0.0;
    gi_linkentity(self_ent);
}

// ============================================================
// Stand normal animation (frames stand60 - stand65)
// ============================================================

static INSANE_FRAMES_STAND_NORMAL: [MFrame; 6] = [
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: Some(insane_checkdown) },
];

pub static INSANE_MOVE_STAND_NORMAL: MMove = MMove {
    firstframe: FRAME_STAND60,
    lastframe: FRAME_STAND65,
    frames: &INSANE_FRAMES_STAND_NORMAL,
    endfunc: Some(insane_stand),
};

// ============================================================
// Stand insane animation (frames stand65 - stand94)
// ============================================================

static INSANE_FRAMES_STAND_INSANE: [MFrame; 30] = [
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: Some(insane_shake) },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_stand, dist: 0.0, think_fn: Some(insane_checkdown) },
];

pub static INSANE_MOVE_STAND_INSANE: MMove = MMove {
    firstframe: FRAME_STAND65,
    lastframe: FRAME_STAND94,
    frames: &INSANE_FRAMES_STAND_INSANE,
    endfunc: Some(insane_stand),
};

// ============================================================
// Up-to-down animation (frames stand1 - stand40)
// ============================================================

static INSANE_FRAMES_UPTODOWN: [MFrame; 40] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_moan) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 2.7, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 4.1, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 6.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 7.6, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 3.6, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_fist) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_fist) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_UPTODOWN: MMove = MMove {
    firstframe: FRAME_STAND1,
    lastframe: FRAME_STAND40,
    frames: &INSANE_FRAMES_UPTODOWN,
    endfunc: Some(insane_onground),
};

// ============================================================
// Down-to-up animation (frames stand41 - stand59)
// ============================================================

static INSANE_FRAMES_DOWNTOUP: [MFrame; 19] = [
    MFrame { ai_fn: ai_move, dist: -0.7, think_fn: None },   // 41
    MFrame { ai_fn: ai_move, dist: -1.2, think_fn: None },   // 42
    MFrame { ai_fn: ai_move, dist: -1.5, think_fn: None },   // 43
    MFrame { ai_fn: ai_move, dist: -4.5, think_fn: None },   // 44
    MFrame { ai_fn: ai_move, dist: -3.5, think_fn: None },   // 45
    MFrame { ai_fn: ai_move, dist: -0.2, think_fn: None },   // 46
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 47
    MFrame { ai_fn: ai_move, dist: -1.3, think_fn: None },   // 48
    MFrame { ai_fn: ai_move, dist: -3.0, think_fn: None },   // 49
    MFrame { ai_fn: ai_move, dist: -2.0, think_fn: None },   // 50
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 51
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 52
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 53
    MFrame { ai_fn: ai_move, dist: -3.3, think_fn: None },   // 54
    MFrame { ai_fn: ai_move, dist: -1.6, think_fn: None },   // 55
    MFrame { ai_fn: ai_move, dist: -0.3, think_fn: None },   // 56
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 57
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 58
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },    // 59
];

pub static INSANE_MOVE_DOWNTOUP: MMove = MMove {
    firstframe: FRAME_STAND41,
    lastframe: FRAME_STAND59,
    frames: &INSANE_FRAMES_DOWNTOUP,
    endfunc: Some(insane_stand),
};

// ============================================================
// Jump down animation (frames stand96 - stand100)
// ============================================================

static INSANE_FRAMES_JUMPDOWN: [MFrame; 5] = [
    MFrame { ai_fn: ai_move, dist: 0.2, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 11.5, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 5.1, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 7.1, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_JUMPDOWN: MMove = MMove {
    firstframe: FRAME_STAND96,
    lastframe: FRAME_STAND100,
    frames: &INSANE_FRAMES_JUMPDOWN,
    endfunc: Some(insane_onground),
};

// ============================================================
// Down animation (frames stand100 - stand160)
// ============================================================

static INSANE_FRAMES_DOWN: [MFrame; 61] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 100
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 110
    MFrame { ai_fn: ai_move, dist: -1.7, think_fn: None },
    MFrame { ai_fn: ai_move, dist: -1.6, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_fist) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 120
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 130
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_moan) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 140
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },       // 150
    MFrame { ai_fn: ai_move, dist: 0.5, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: -0.2, think_fn: Some(insane_scream) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.2, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.4, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.6, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.8, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.7, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_checkup) }, // 160
];

pub static INSANE_MOVE_DOWN: MMove = MMove {
    firstframe: FRAME_STAND100,
    lastframe: FRAME_STAND160,
    frames: &INSANE_FRAMES_DOWN,
    endfunc: Some(insane_onground),
};

// ============================================================
// Walk normal animation (frames walk27 - walk39)
// ============================================================

static INSANE_FRAMES_WALK_NORMAL: [MFrame; 13] = [
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: Some(insane_scream) },
    MFrame { ai_fn: ai_walk, dist: 2.5, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 3.5, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 1.7, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.3, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.4, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.2, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 4.2, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 5.6, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 3.3, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.4, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 0.9, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_WALK_NORMAL: MMove = MMove {
    firstframe: FRAME_WALK27,
    lastframe: FRAME_WALK39,
    frames: &INSANE_FRAMES_WALK_NORMAL,
    endfunc: Some(insane_walk),
};

pub static INSANE_MOVE_RUN_NORMAL: MMove = MMove {
    firstframe: FRAME_WALK27,
    lastframe: FRAME_WALK39,
    frames: &INSANE_FRAMES_WALK_NORMAL,
    endfunc: Some(insane_run),
};

// ============================================================
// Walk insane animation (frames walk1 - walk26)
// ============================================================

static INSANE_FRAMES_WALK_INSANE: [MFrame; 26] = [
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: Some(insane_scream) }, // walk 1
    MFrame { ai_fn: ai_walk, dist: 3.4, think_fn: None },   // walk 2
    MFrame { ai_fn: ai_walk, dist: 3.6, think_fn: None },   // 3
    MFrame { ai_fn: ai_walk, dist: 2.9, think_fn: None },   // 4
    MFrame { ai_fn: ai_walk, dist: 2.2, think_fn: None },   // 5
    MFrame { ai_fn: ai_walk, dist: 2.6, think_fn: None },   // 6
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },   // 7
    MFrame { ai_fn: ai_walk, dist: 0.7, think_fn: None },   // 8
    MFrame { ai_fn: ai_walk, dist: 4.8, think_fn: None },   // 9
    MFrame { ai_fn: ai_walk, dist: 5.3, think_fn: None },   // 10
    MFrame { ai_fn: ai_walk, dist: 1.1, think_fn: None },   // 11
    MFrame { ai_fn: ai_walk, dist: 2.0, think_fn: None },   // 12
    MFrame { ai_fn: ai_walk, dist: 0.5, think_fn: None },   // 13
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },   // 14
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },   // 15
    MFrame { ai_fn: ai_walk, dist: 4.9, think_fn: None },   // 16
    MFrame { ai_fn: ai_walk, dist: 6.7, think_fn: None },   // 17
    MFrame { ai_fn: ai_walk, dist: 3.8, think_fn: None },   // 18
    MFrame { ai_fn: ai_walk, dist: 2.0, think_fn: None },   // 19
    MFrame { ai_fn: ai_walk, dist: 0.2, think_fn: None },   // 20
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },   // 21
    MFrame { ai_fn: ai_walk, dist: 3.4, think_fn: None },   // 22
    MFrame { ai_fn: ai_walk, dist: 6.4, think_fn: None },   // 23
    MFrame { ai_fn: ai_walk, dist: 5.0, think_fn: None },   // 24
    MFrame { ai_fn: ai_walk, dist: 1.8, think_fn: None },   // 25
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: None },   // 26
];

pub static INSANE_MOVE_WALK_INSANE: MMove = MMove {
    firstframe: FRAME_WALK1,
    lastframe: FRAME_WALK26,
    frames: &INSANE_FRAMES_WALK_INSANE,
    endfunc: Some(insane_walk),
};

pub static INSANE_MOVE_RUN_INSANE: MMove = MMove {
    firstframe: FRAME_WALK1,
    lastframe: FRAME_WALK26,
    frames: &INSANE_FRAMES_WALK_INSANE,
    endfunc: Some(insane_run),
};

// ============================================================
// Stand pain animation (frames st_pain2 - st_pain12)
// ============================================================

static INSANE_FRAMES_STAND_PAIN: [MFrame; 11] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_STAND_PAIN: MMove = MMove {
    firstframe: FRAME_ST_PAIN2,
    lastframe: FRAME_ST_PAIN12,
    frames: &INSANE_FRAMES_STAND_PAIN,
    endfunc: Some(insane_run),
};

// ============================================================
// Stand death animation (frames st_death2 - st_death18)
// ============================================================

static INSANE_FRAMES_STAND_DEATH: [MFrame; 17] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_STAND_DEATH: MMove = MMove {
    firstframe: FRAME_ST_DEATH2,
    lastframe: FRAME_ST_DEATH18,
    frames: &INSANE_FRAMES_STAND_DEATH,
    endfunc: Some(insane_dead),
};

// ============================================================
// Crawl animation (frames crawl1 - crawl9)
// ============================================================

static INSANE_FRAMES_CRAWL: [MFrame; 9] = [
    MFrame { ai_fn: ai_walk, dist: 0.0, think_fn: Some(insane_scream) },
    MFrame { ai_fn: ai_walk, dist: 1.5, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.1, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 3.6, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.0, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 0.9, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 3.0, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 3.4, think_fn: None },
    MFrame { ai_fn: ai_walk, dist: 2.4, think_fn: None },
];

pub static INSANE_MOVE_CRAWL: MMove = MMove {
    firstframe: FRAME_CRAWL1,
    lastframe: FRAME_CRAWL9,
    frames: &INSANE_FRAMES_CRAWL,
    endfunc: None,
};

pub static INSANE_MOVE_RUNCRAWL: MMove = MMove {
    firstframe: FRAME_CRAWL1,
    lastframe: FRAME_CRAWL9,
    frames: &INSANE_FRAMES_CRAWL,
    endfunc: None,
};

// ============================================================
// Crawl pain animation (frames cr_pain2 - cr_pain10)
// ============================================================

static INSANE_FRAMES_CRAWL_PAIN: [MFrame; 9] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_CRAWL_PAIN: MMove = MMove {
    firstframe: FRAME_CR_PAIN2,
    lastframe: FRAME_CR_PAIN10,
    frames: &INSANE_FRAMES_CRAWL_PAIN,
    endfunc: Some(insane_run),
};

// ============================================================
// Crawl death animation (frames cr_death10 - cr_death16)
// ============================================================

static INSANE_FRAMES_CRAWL_DEATH: [MFrame; 7] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_CRAWL_DEATH: MMove = MMove {
    firstframe: FRAME_CR_DEATH10,
    lastframe: FRAME_CR_DEATH16,
    frames: &INSANE_FRAMES_CRAWL_DEATH,
    endfunc: Some(insane_dead),
};

// ============================================================
// Cross animation (frames cross1 - cross15)
// ============================================================

static INSANE_FRAMES_CROSS: [MFrame; 15] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_moan) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_CROSS: MMove = MMove {
    firstframe: FRAME_CROSS1,
    lastframe: FRAME_CROSS15,
    frames: &INSANE_FRAMES_CROSS,
    endfunc: Some(insane_cross),
};

// ============================================================
// Struggle cross animation (frames cross16 - cross30)
// ============================================================

static INSANE_FRAMES_STRUGGLE_CROSS: [MFrame; 15] = [
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: Some(insane_scream) },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
    MFrame { ai_fn: ai_move, dist: 0.0, think_fn: None },
];

pub static INSANE_MOVE_STRUGGLE_CROSS: MMove = MMove {
    firstframe: FRAME_CROSS16,
    lastframe: FRAME_CROSS30,
    frames: &INSANE_FRAMES_STRUGGLE_CROSS,
    endfunc: Some(insane_cross),
};

// ============================================================
// Pain
// ============================================================

pub fn insane_pain(self_ent: &mut Edict, _other: &mut Edict, _kick: f32, _damage: i32, ctx: &mut GameContext) {
    if ctx.level.time < self_ent.pain_debounce_time {
        return;
    }

    self_ent.pain_debounce_time = ctx.level.time + 3.0;

    let r = 1 + (rand_i32() & 1);
    let l;
    if self_ent.health < 25 {
        l = 25;
    } else if self_ent.health < 50 {
        l = 50;
    } else if self_ent.health < 75 {
        l = 75;
    } else {
        l = 100;
    }
    gi_sound(self_ent, CHAN_VOICE, gi_soundindex(&va_pain_sound(l, r)), 1.0, ATTN_IDLE, 0.0);

    // skill->value == 3 means nightmare: no pain anims
    if skill_value() == 3.0 {
        return; // no pain anims in nightmare
    }

    // Don't go into pain frames if crucified.
    if self_ent.spawnflags & 8 != 0 {
        self_ent.monsterinfo.currentmove = Some(MOVE_STRUGGLE_CROSS);
        return;
    }

    if ((self_ent.s.frame >= FRAME_CRAWL1) && (self_ent.s.frame <= FRAME_CRAWL9))
        || ((self_ent.s.frame >= FRAME_STAND99) && (self_ent.s.frame <= FRAME_STAND160))
    {
        self_ent.monsterinfo.currentmove = Some(MOVE_CRAWL_PAIN);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_STAND_PAIN);
    }
}

// ============================================================
// Die
// ============================================================

pub fn insane_die(self_ent: &mut Edict, _inflictor: &mut Edict, _attacker: &mut Edict, damage: i32, _point: [f32; 3], _ctx: &mut GameContext) {
    if self_ent.health <= self_ent.gib_health {
        gi_sound(self_ent, CHAN_VOICE, gi_soundindex("misc/udeath.wav"), 1.0, ATTN_IDLE, 0.0);
        for _ in 0..2 {
            throw_gib(self_ent, "models/objects/gibs/bone/tris.md2", damage, GIB_ORGANIC);
        }
        for _ in 0..4 {
            throw_gib(self_ent, "models/objects/gibs/sm_meat/tris.md2", damage, GIB_ORGANIC);
        }
        throw_head(self_ent, "models/objects/gibs/head2/tris.md2", damage, GIB_ORGANIC);
        self_ent.deadflag = DEAD_DEAD;
        return;
    }

    if self_ent.deadflag == DEAD_DEAD {
        return;
    }

    let death_snd_idx = (rand_i32() % 4) + 1;
    gi_sound(self_ent, CHAN_VOICE, gi_soundindex(&va_death_sound(death_snd_idx)), 1.0, ATTN_IDLE, 0.0);

    self_ent.deadflag = DEAD_DEAD;
    self_ent.takedamage = Damage::Yes as i32;

    if self_ent.spawnflags & 8 != 0 {
        insane_dead(self_ent, _ctx);
    } else if ((self_ent.s.frame >= FRAME_CRAWL1) && (self_ent.s.frame <= FRAME_CRAWL9))
        || ((self_ent.s.frame >= FRAME_STAND99) && (self_ent.s.frame <= FRAME_STAND160))
    {
        self_ent.monsterinfo.currentmove = Some(MOVE_CRAWL_DEATH);
    } else {
        self_ent.monsterinfo.currentmove = Some(MOVE_STAND_DEATH);
    }
}

// ============================================================
// Spawn function
// ============================================================

/// QUAKED misc_insane (1 .5 0) (-16 -16 -24) (16 16 32) Ambush Trigger_Spawn CRAWL CRUCIFIED STAND_GROUND ALWAYS_STAND
pub fn sp_misc_insane(self_ent: &mut Edict, ctx: &mut GameContext) {
    if ctx.deathmatch != 0.0 {
        g_free_edict(self_ent);
        return;
    }

    // Pre-caches
    SOUNDS.get_or_init(|| InsaneSounds {
        fist: gi_soundindex("insane/insane11.wav"),
        shake: gi_soundindex("insane/insane5.wav"),
        moan: gi_soundindex("insane/insane7.wav"),
        scream: [
            gi_soundindex("insane/insane1.wav"),
            gi_soundindex("insane/insane2.wav"),
            gi_soundindex("insane/insane3.wav"),
            gi_soundindex("insane/insane4.wav"),
            gi_soundindex("insane/insane6.wav"),
            gi_soundindex("insane/insane8.wav"),
            gi_soundindex("insane/insane9.wav"),
            gi_soundindex("insane/insane10.wav"),
        ],
    });

    self_ent.movetype = MoveType::Step;
    self_ent.solid = Solid::Bbox;
    self_ent.s.modelindex = gi_modelindex("models/monsters/insane/tris.md2");

    self_ent.mins = [-16.0, -16.0, -24.0];
    self_ent.maxs = [16.0, 16.0, 32.0];

    self_ent.health = 100;
    self_ent.gib_health = -50;
    self_ent.mass = 300;

    self_ent.pain_fn = Some(crate::dispatch::PAIN_INSANE);
    self_ent.die_fn = Some(crate::dispatch::DIE_INSANE);

    self_ent.monsterinfo.stand_fn = Some(crate::dispatch::MSTAND_INSANE);
    self_ent.monsterinfo.walk_fn = Some(crate::dispatch::MWALK_INSANE);
    self_ent.monsterinfo.run_fn = Some(crate::dispatch::MRUN_INSANE);
    self_ent.monsterinfo.dodge_fn = None;
    self_ent.monsterinfo.attack_fn = None;
    self_ent.monsterinfo.melee_fn = None;
    self_ent.monsterinfo.sight_fn = None;
    self_ent.monsterinfo.aiflags |= AI_GOOD_GUY;

    gi_linkentity(self_ent);

    if self_ent.spawnflags & 16 != 0 {
        // Stand Ground
        self_ent.monsterinfo.aiflags |= AI_STAND_GROUND;
    }

    self_ent.monsterinfo.currentmove = Some(MOVE_STAND_NORMAL);
    self_ent.monsterinfo.scale = MODEL_SCALE;

    if self_ent.spawnflags & 8 != 0 {
        // Crucified?
        self_ent.mins = [-16.0, 0.0, 0.0];
        self_ent.maxs = [16.0, 8.0, 32.0];
        self_ent.flags |= FL_NO_KNOCKBACK;
        flymonster_start(self_ent);
    } else {
        walkmonster_start(self_ent);
        self_ent.s.skinnum = rand_i32() % 3;
    }
}

// ============================================================
// Move table: maps move indices to MMove statics
// ============================================================

/// Returns the MMove for a given insane move index.
pub fn insane_get_move(index: usize) -> Option<&'static MMove> {
    match index {
        MOVE_STAND_NORMAL => Some(&INSANE_MOVE_STAND_NORMAL),
        MOVE_STAND_INSANE => Some(&INSANE_MOVE_STAND_INSANE),
        MOVE_UPTODOWN => Some(&INSANE_MOVE_UPTODOWN),
        MOVE_DOWNTOUP => Some(&INSANE_MOVE_DOWNTOUP),
        MOVE_JUMPDOWN => Some(&INSANE_MOVE_JUMPDOWN),
        MOVE_DOWN => Some(&INSANE_MOVE_DOWN),
        MOVE_WALK_NORMAL => Some(&INSANE_MOVE_WALK_NORMAL),
        MOVE_RUN_NORMAL => Some(&INSANE_MOVE_RUN_NORMAL),
        MOVE_WALK_INSANE => Some(&INSANE_MOVE_WALK_INSANE),
        MOVE_RUN_INSANE => Some(&INSANE_MOVE_RUN_INSANE),
        MOVE_STAND_PAIN => Some(&INSANE_MOVE_STAND_PAIN),
        MOVE_STAND_DEATH => Some(&INSANE_MOVE_STAND_DEATH),
        MOVE_CRAWL => Some(&INSANE_MOVE_CRAWL),
        MOVE_RUNCRAWL => Some(&INSANE_MOVE_RUNCRAWL),
        MOVE_CRAWL_PAIN => Some(&INSANE_MOVE_CRAWL_PAIN),
        MOVE_CRAWL_DEATH => Some(&INSANE_MOVE_CRAWL_DEATH),
        MOVE_CROSS => Some(&INSANE_MOVE_CROSS),
        MOVE_STRUGGLE_CROSS => Some(&INSANE_MOVE_STRUGGLE_CROSS),
        _ => None,
    }
}
